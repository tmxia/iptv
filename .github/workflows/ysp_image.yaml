name: Build YSP Multi-Platform Images

on:
  workflow_dispatch:  # ä»…æ‰‹åŠ¨è§¦å‘
    inputs:
      version:
        description: 'é•œåƒç‰ˆæœ¬æ ‡ç­¾'
        required: true
        default: 'latest'

jobs:
  setup:
    runs-on: ubuntu-latest
    outputs:
      project_exists: ${{ steps.check.outputs.project_exists }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          path: source  # æŒ‡å®šæ£€å‡ºè·¯å¾„

      - name: Check project structure
        id: check
        run: |
          echo "å½“å‰å·¥ä½œç›®å½•: $(pwd)"
          echo "ç›®å½•ç»“æž„:"
          ls -la
          
          echo "æ£€æŸ¥sourceç›®å½•:"
          ls -la source/
          
          # æ£€æŸ¥yspç›®å½•æ˜¯å¦å­˜åœ¨
          if [ -d "source/ysp" ]; then
            echo "æ‰¾åˆ°yspç›®å½•"
            echo "é¡¹ç›®ç›®å½•å†…å®¹:"
            ls -la source/ysp/
            
            # æ£€æŸ¥å¿…è¦æ–‡ä»¶
            if [ -f "source/ysp/main.go" ] && [ -f "source/ysp/Dockerfile" ] && [ -f "source/ysp/go.mod" ]; then
              echo "âœ“ æ‰€æœ‰å¿…è¦æ–‡ä»¶éƒ½å­˜åœ¨"
              echo "project_exists=true" >> $GITHUB_OUTPUT
            else
              echo "é”™è¯¯ï¼šç¼ºå°‘å¿…è¦æ–‡ä»¶"
              echo "main.go å­˜åœ¨: $([ -f "source/ysp/main.go" ] && echo "æ˜¯" || echo "å¦")"
              echo "Dockerfile å­˜åœ¨: $([ -f "source/ysp/Dockerfile" ] && echo "æ˜¯" || echo "å¦")"
              echo "go.mod å­˜åœ¨: $([ -f "source/ysp/go.mod" ] && echo "æ˜¯" || echo "å¦")"
              echo "project_exists=false" >> $GITHUB_OUTPUT
              exit 1
            fi
          else
            echo "é”™è¯¯ï¼šæœªæ‰¾åˆ°yspç›®å½•"
            echo "project_exists=false" >> $GITHUB_OUTPUT
            exit 1
          fi

  build:
    needs: setup
    if: needs.setup.outputs.project_exists == 'true'
    runs-on: ubuntu-latest
    strategy:
      matrix:
        platform:
          - name: linux/amd64
            target: x86_64
            goarch: amd64
          - name: linux/arm64
            target: aarch64
            goarch: arm64
          - name: linux/arm/v7
            target: armv7
            goarch: arm
            govariant: v7
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          path: source  # ä¸Žsetupæ­¥éª¤ä¿æŒä¸€è‡´

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      - name: Navigate to project directory
        run: |
          echo "åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•..."
          cd source/ysp
          echo "å½“å‰ç›®å½•: $(pwd)"
          echo "é¡¹ç›®æ–‡ä»¶åˆ—è¡¨:"
          ls -la
          echo ""
          echo "main.go å‰å‡ è¡Œ:"
          head -5 main.go
          echo ""
          echo "Dockerfile å‰å‡ è¡Œ:"
          head -10 Dockerfile
          echo ""
          echo "go.mod å†…å®¹:"
          cat go.mod

      - name: Tidy Go modules
        run: |
          cd source/ysp
          echo "æ•´ç†Goæ¨¡å—..."
          go mod tidy
          echo "æ•´ç†å®Œæˆ"
          echo "go.modå†…å®¹:"
          cat go.mod

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build Docker image
        run: |
          cd source/ysp
          
          echo "æž„å»º ${{ matrix.platform.name }} é•œåƒ..."
          echo "ä½¿ç”¨Dockerfile:"
          cat Dockerfile
          
          # å‡†å¤‡æž„å»ºå‚æ•°
          BUILD_ARGS=""
          if [ "${{ matrix.platform.govariant }}" != "" ]; then
            BUILD_ARGS="--build-arg TARGETVARIANT=${{ matrix.platform.govariant }}"
          fi
          
          # æž„å»ºé•œåƒå¹¶å¯¼å‡ºä¸ºtaræ–‡ä»¶
          docker buildx build \
            --platform ${{ matrix.platform.name }} \
            --output type=docker,dest=./ysp-${{ matrix.platform.target }}.tar \
            -t ysp:${{ matrix.platform.target }} \
            -t ysp:${{ github.event.inputs.version }}-${{ matrix.platform.target }} \
            --build-arg TARGETARCH=${{ matrix.platform.goarch }} \
            $BUILD_ARGS \
            .
          
          echo "é•œåƒæž„å»ºå®Œæˆ:"
          ls -lh ysp-${{ matrix.platform.target }}.tar

      - name: Test Docker image
        run: |
          cd source/ysp
          
          echo "æµ‹è¯• ${{ matrix.platform.name }} é•œåƒ..."
          
          # åŠ è½½é•œåƒ
          docker load -i ysp-${{ matrix.platform.target }}.tar
          
          # ç”Ÿæˆéšæœºç«¯å£é¿å…å†²çª
          TEST_PORT=$((9824 + RANDOM % 5000))
          echo "ä½¿ç”¨ç«¯å£ $TEST_PORT è¿›è¡Œæµ‹è¯•"
          
          # å¯åŠ¨å®¹å™¨
          docker run -d \
            --name ysp-test-${{ matrix.platform.target }} \
            -p $TEST_PORT:9824 \
            -e HOST_IP=0.0.0.0 \
            ysp:${{ matrix.platform.target }}
          
          # ç­‰å¾…æœåŠ¡å¯åŠ¨
          echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
          MAX_WAIT=30
          for i in $(seq 1 $MAX_WAIT); do
            if curl -s -f http://localhost:$TEST_PORT/ > /dev/null 2>&1; then
              echo "âœ“ æœåŠ¡åœ¨ç¬¬ $i ç§’å¯åŠ¨æˆåŠŸ"
              break
            fi
            if [ $i -eq $MAX_WAIT ]; then
              echo "âœ— æœåŠ¡å¯åŠ¨è¶…æ—¶"
              echo "å®¹å™¨æ—¥å¿—:"
              docker logs ysp-test-${{ matrix.platform.target }}
              exit 1
            fi
            sleep 1
          done
          
          # æµ‹è¯•M3Uç«¯ç‚¹
          echo "æµ‹è¯•M3Uç«¯ç‚¹..."
          M3U_CONTENT=$(curl -s http://localhost:$TEST_PORT/ysp.m3u | head -5)
          if echo "$M3U_CONTENT" | grep -q "#EXTM3U"; then
            echo "âœ“ M3Uç«¯ç‚¹æ­£å¸¸"
            echo "M3Uå‰5è¡Œ:"
            echo "$M3U_CONTENT"
          else
            echo "âœ— M3Uç«¯ç‚¹å¼‚å¸¸ï¼Œè¿”å›žå†…å®¹:"
            echo "$M3U_CONTENT"
            exit 1
          fi
          
          # æµ‹è¯•é¢‘é“ç«¯ç‚¹
          echo "æµ‹è¯•é¢‘é“ç«¯ç‚¹..."
          CHANNEL_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:$TEST_PORT/ysp?id=cctv1)
          if [ "$CHANNEL_STATUS" = "302" ] || [ "$CHANNEL_STATUS" = "200" ]; then
            echo "âœ“ é¢‘é“ç«¯ç‚¹æ­£å¸¸ï¼ŒçŠ¶æ€ç : $CHANNEL_STATUS"
          else
            echo "âœ— é¢‘é“ç«¯ç‚¹å¼‚å¸¸ï¼ŒçŠ¶æ€ç : $CHANNEL_STATUS"
            exit 1
          fi
          
          # åœæ­¢å¹¶æ¸…ç†æµ‹è¯•å®¹å™¨
          docker stop ysp-test-${{ matrix.platform.target }}
          docker rm ysp-test-${{ matrix.platform.target }}
          
          echo "âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡"

      - name: Save image locally
        run: |
          cd source/ysp
          
          # åˆ›å»ºimagesç›®å½•
          mkdir -p images
          
          # å¤åˆ¶é•œåƒæ–‡ä»¶åˆ°imagesç›®å½•
          cp ysp-${{ matrix.platform.target }}.tar images/
          
          # åˆ›å»ºSHA256æ ¡éªŒå’Œ
          sha256sum images/ysp-${{ matrix.platform.target }}.tar > images/ysp-${{ matrix.platform.target }}.tar.sha256
          
          echo "é•œåƒæ–‡ä»¶å·²ä¿å­˜:"
          ls -lh images/

      - name: Upload platform image
        uses: actions/upload-artifact@v4
        with:
          name: ysp-${{ matrix.platform.target }}-image
          path: source/ysp/images/ysp-${{ matrix.platform.target }}.tar
          retention-days: 30

      - name: Upload checksum
        uses: actions/upload-artifact@v4
        with:
          name: ysp-${{ matrix.platform.target }}-checksum
          path: source/ysp/images/ysp-${{ matrix.platform.target }}.tar.sha256
          retention-days: 30

  package:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create release package
        run: |
          mkdir -p release-package
          
          # åˆ›å»ºç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶
          cat > release-package/README.md << EOF
          # YSP Server å¤šå¹³å°Dockeré•œåƒ
          
          ç‰ˆæœ¬: ${{ github.event.inputs.version }}
          æž„å»ºæ—¶é—´: $(date -u +"%Y-%m-%d %H:%M:%S UTC")
          æž„å»ºID: ${{ github.run_id }}
          æäº¤: ${{ github.sha }}
          è§¦å‘è€…: ${{ github.actor }}
          
          ## åŒ…å«çš„é•œåƒæ–‡ä»¶
          
          1. **ysp-x86_64.tar** - Linux amd64/x86_64 å¹³å°
          2. **ysp-aarch64.tar** - Linux arm64/aarch64 å¹³å°  
          3. **ysp-armv7.tar** - Linux arm/v7 å¹³å°
          
          æ¯ä¸ªé•œåƒæ–‡ä»¶éƒ½åŒ…å«å¯¹åº”çš„SHA256æ ¡éªŒå’Œæ–‡ä»¶ã€‚
          
          ## ä¸‹è½½åœ°å€
          
          è¯·è®¿é—®GitHub Actionsçš„Artifactséƒ¨åˆ†ä¸‹è½½ï¼š
          
          1. å‰å¾€æ­¤å·¥ä½œæµçš„è¿è¡Œé¡µé¢
          2. åœ¨"Artifacts"éƒ¨åˆ†æ‰¾åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š
             - ysp-x86_64-image
             - ysp-aarch64-image  
             - ysp-armv7-image
          
          ## ä½¿ç”¨æ–¹æ³•
          
          ### 1. åŠ è½½é•œåƒ
          \`\`\`bash
          # åŠ è½½amd64é•œåƒ
          docker load -i ysp-x86_64.tar
          \`\`\`
          
          ### 2. è¿è¡Œå®¹å™¨
          \`\`\`bash
          # è¿è¡ŒæœåŠ¡
          docker run -d \\
            -p 9824:9824 \\
            --name ysp-server \\
            ysp:x86_64
          
          # æŒ‡å®šä¸»æœºIP
          docker run -d \\
            -p 9824:9824 \\
            -e HOST_IP=0.0.0.0 \\
            --name ysp-server \\
            ysp:x86_64
          
          # æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°
          docker run -d \\
            -p 9824:9824 \\
            --name ysp-server \\
            ysp:x86_64 --host=0.0.0.0
          \`\`\`
          
          ### 3. è®¿é—®æœåŠ¡
          
          - **æ’­æ”¾åˆ—è¡¨**: http://localhost:9824/ysp.m3u
          - **Webç•Œé¢**: http://localhost:9824/
          - **å•ä¸ªé¢‘é“**: http://localhost:9824/ysp?id=cctv1
          - **é€šè¿‡å‚æ•°**: http://localhost:9824/ysp?cnlid=2024078201&livepid=600001859
          
          ### 4. åœæ­¢æœåŠ¡
          \`\`\`bash
          docker stop ysp-server
          docker rm ysp-server
          \`\`\`
          
          ## é•œåƒä¿¡æ¯
          
          - **åŸºç¡€é•œåƒ**: scratch (æœ€å°åŒ–)
          - **æš´éœ²ç«¯å£**: 9824
          - **å…¥å£ç‚¹**: /ysp
          - **æž¶æž„**: å¤šæž¶æž„æ”¯æŒ
          
          ## æºç 
          
          é¡¹ç›®æºç ä½äºŽ: https://github.com/${{ github.repository }}
          EOF
          
          # åˆ›å»ºåŠ è½½è„šæœ¬
          cat > release-package/load-all.sh << 'EOF'
          #!/bin/bash
          # YSP Server Dockeré•œåƒæ‰¹é‡åŠ è½½è„šæœ¬
          
          set -e
          
          echo "=== YSP Server é•œåƒåŠ è½½å·¥å…· ==="
          echo ""
          
          # æ£€æŸ¥Dockeræ˜¯å¦è¿è¡Œ
          if ! docker info > /dev/null 2>&1; then
            echo "é”™è¯¯: Dockerå®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œ"
            exit 1
          fi
          
          # æ£€æŸ¥æ–‡ä»¶
          IMAGES=("ysp-x86_64.tar" "ysp-aarch64.tar" "ysp-armv7.tar")
          
          for img in "${IMAGES[@]}"; do
            if [ -f "$img" ]; then
              echo "æ‰¾åˆ°é•œåƒæ–‡ä»¶: $img"
            else
              echo "è­¦å‘Š: æœªæ‰¾åˆ° $img"
            fi
          done
          
          echo ""
          echo "å¼€å§‹åŠ è½½é•œåƒ..."
          echo ""
          
          # åŠ è½½é•œåƒ
          for img in "${IMAGES[@]}"; do
            if [ -f "$img" ]; then
              echo "åŠ è½½ $img..."
              docker load -i "$img"
              echo "âœ“ $img åŠ è½½å®Œæˆ"
              echo ""
            fi
          done
          
          echo "=== åŠ è½½å®Œæˆ ==="
          echo ""
          echo "å¯ç”¨é•œåƒ:"
          docker images | grep "ysp" | sort
          
          echo ""
          echo "è¿è¡Œç¤ºä¾‹:"
          echo "  docker run -d -p 9824:9824 --name ysp-server ysp:x86_64"
          echo ""
          EOF
          
          chmod +x release-package/load-all.sh
          
          # åˆ›å»ºéªŒè¯è„šæœ¬
          cat > release-package/verify.sh << 'EOF'
          #!/bin/bash
          # éªŒè¯é•œåƒæ–‡ä»¶å®Œæ•´æ€§
          
          echo "éªŒè¯é•œåƒæ–‡ä»¶å®Œæ•´æ€§..."
          echo ""
          
          for file in *.tar; do
            if [ -f "$file" ]; then
              echo "æ£€æŸ¥ $file..."
              
              # æ£€æŸ¥æ–‡ä»¶å¤§å°
              size=$(stat -c%s "$file" 2>/dev/null || stat -f%z "$file")
              echo "  å¤§å°: $((size/1024/1024)) MB"
              
              # å¦‚æžœæœ‰æ ¡éªŒå’Œæ–‡ä»¶ï¼Œè¿›è¡ŒéªŒè¯
              if [ -f "$file.sha256" ]; then
                echo "  éªŒè¯SHA256..."
                sha256sum -c "$file.sha256" && echo "  âœ“ æ ¡éªŒé€šè¿‡" || echo "  âœ— æ ¡éªŒå¤±è´¥"
              else
                echo "  âš  æ— æ ¡éªŒæ–‡ä»¶"
              fi
              
              echo ""
            fi
          done
          
          echo "éªŒè¯å®Œæˆ"
          EOF
          
          chmod +x release-package/verify.sh
          
          echo "å‘å¸ƒåŒ…åˆ›å»ºå®Œæˆ:"
          ls -la release-package/

      - name: Upload release package
        uses: actions/upload-artifact@v4
        with:
          name: ysp-release-package-${{ github.event.inputs.version }}
          path: release-package/
          retention-days: 30

  summary:
    needs: [setup, build, package]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Generate build summary
        run: |
          echo "# ðŸ³ YSP Server å¤šå¹³å°é•œåƒæž„å»ºæŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ðŸ“‹ æž„å»ºä¿¡æ¯" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **ç‰ˆæœ¬**: ${{ github.event.inputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "- **çŠ¶æ€**: ${{ job.status == 'success' && 'âœ… æˆåŠŸ' || 'âŒ å¤±è´¥' }}" >> $GITHUB_STEP_SUMMARY
          echo "- **æ—¶é—´**: $(date -u +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "- **è¿è¡ŒID**: [${{ github.run_id }}](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ðŸ–¥ï¸ æž„å»ºå¹³å°" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| å¹³å° | çŠ¶æ€ | ä¸‹è½½ |" >> $GITHUB_STEP_SUMMARY
          echo "|------|------|------|" >> $GITHUB_STEP_SUMMARY
          echo "| Linux amd64/x86_64 | âœ… | [ysp-x86_64-image](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) |" >> $GITHUB_STEP_SUMMARY
          echo "| Linux arm64/aarch64 | âœ… | [ysp-aarch64-image](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) |" >> $GITHUB_STEP_SUMMARY
          echo "| Linux arm/v7 | âœ… | [ysp-armv7-image](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ðŸ“¦ ä¸‹è½½æ–‡ä»¶" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "åœ¨æœ¬æ¬¡å·¥ä½œæµçš„ **Artifacts** éƒ¨åˆ†å¯ä»¥ä¸‹è½½ä»¥ä¸‹æ–‡ä»¶ï¼š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. **å„å¹³å°é•œåƒæ–‡ä»¶**: " >> $GITHUB_STEP_SUMMARY
          echo "   - `ysp-x86_64-image` - AMD64å¹³å°é•œåƒ" >> $GITHUB_STEP_SUMMARY
          echo "   - `ysp-aarch64-image` - ARM64å¹³å°é•œåƒ" >> $GITHUB_STEP_SUMMARY
          echo "   - `ysp-armv7-image` - ARMv7å¹³å°é•œåƒ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "2. **æ ¡éªŒå’Œæ–‡ä»¶**: " >> $GITHUB_STEP_SUMMARY
          echo "   - æ¯ä¸ªé•œåƒéƒ½åŒ…å«å¯¹åº”çš„SHA256æ ¡éªŒæ–‡ä»¶" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "3. **å‘å¸ƒåŒ…**: " >> $GITHUB_STEP_SUMMARY
          echo "   - `ysp-release-package-${{ github.event.inputs.version }}` - åŒ…å«ä½¿ç”¨è¯´æ˜Žå’Œå·¥å…·çš„å®Œæ•´åŒ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ðŸš€ å¿«é€Ÿå¼€å§‹" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo '```bash' >> $GITHUB_STEP_SUMMARY
          echo "# 1. ä¸‹è½½å¹¶è§£åŽ‹é•œåƒæ–‡ä»¶" >> $GITHUB_STEP_SUMMARY
          echo "# 2. åŠ è½½é•œåƒåˆ°Docker" >> $GITHUB_STEP_SUMMARY
          echo "docker load -i ysp-x86_64.tar" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# 3. è¿è¡ŒæœåŠ¡" >> $GITHUB_STEP_SUMMARY
          echo "docker run -d -p 9824:9824 --name ysp-server ysp:x86_64" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# 4. è®¿é—®æœåŠ¡" >> $GITHUB_STEP_SUMMARY
          echo "curl http://localhost:9824/ysp.m3u" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ðŸ”§ é¡¹ç›®ä¿¡æ¯" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **é¡¹ç›®ç›®å½•**: ysp/" >> $GITHUB_STEP_SUMMARY
          echo "- **é•œåƒå·²ä¿å­˜åˆ°**: ysp/images/" >> $GITHUB_STEP_SUMMARY
          echo "- **åŒ…å«é¢‘é“**: 60+ä¸ªå¤®è§†é¢‘é“å’Œå«è§†é¢‘é“" >> $GITHUB_STEP_SUMMARY
          echo "- **ç«¯å£**: 9824" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ job.status }}" = "success" ]; then
            echo "## âœ… æž„å»ºæˆåŠŸ" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "æ‰€æœ‰å¹³å°çš„Dockeré•œåƒå·²æˆåŠŸæž„å»ºå¹¶é€šè¿‡æµ‹è¯•ï¼" >> $GITHUB_STEP_SUMMARY
          else
            echo "## âŒ æž„å»ºå¤±è´¥" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "æž„å»ºè¿‡ç¨‹ä¸­å‡ºçŽ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ã€‚" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*æž„å»ºå®Œæˆæ—¶é—´: $(date)*" >> $GITHUB_STEP_SUMMARY